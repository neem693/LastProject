<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="toto">



<insert id="my_game_result_insert" parameterType="vo.My_Game_Result_Vo">

 INSERT INTO my_toto_result(total_money,final_ratio,game_number,m_id) VALUES    
  ( 
  
   #{total_money},
   #{final_ratio},
   #{game_number},
   #{m_id}
   )

</insert>



<insert id="insert_game" parameterType="vo.Toto_Game_Vo">

 INSERT INTO toto_gametable(m_id,game_number,bat_price,ratio,p_idx,bat_win_lose,game_result) VALUES    
  ( 
   #{m_id},
   #{game_number},
   #{bat_price}, 
   #{ratio},
   #{p_idx},
   #{bat_win_lose},
   #{game_result}
   )

</insert>



<select id="my_game_list" parameterType="String"  resultType="vo.My_Game_Result_Vo">
 	<!-- 미처리된 게임 key를 가져온다  -->
	
	SELECT ROUND(total_money,1) AS total_money ,ROUND(Final_ratio,1) AS Final_ratio,m_id,game_number 
	FROM my_toto_result
	where m_id=#{m_id}
    </select>


    <select id="toto_select_game_id" resultType="String">
 	<!-- 미처리된 게임 key를 가져온다  -->
		
	SELECT DISTINCT m_id
	from toto_gametable
	where game_result='T'

    </select>


    <select id="toto_select_game_key" parameterType ="String" resultType="String">
 	<!-- 미처리된 게임 key를 가져온다  -->
		
		SELECT DISTINCT game_number
		FROM(
				SELECT * 
				FROM toto_gametable
				WHERE m_id=#{m_idx} AND game_result='T'
			) g_num
 
    </select>

	    <select id="toto_select_pick_game" parameterType ="String" resultType="vo.Toto_Game_Vo">
 	<!--  게임 key를 가지고 해당 게임 리스트를 불러온다.  -->
		
			SELECT * FROM toto_gametable
			WHERE game_number=#{game_num}
 
    </select>
	    <select id="toto_select_game_result_info" parameterType ="String" resultType="String">
 	<!--  업데이트 된 게임 결과를 가져온다.  -->
			SELECT p_rts FROM play
			WHERE p_idx=#{p_idx}
    </select>

	
	 
	 <select id="toto_my_bating_list" parameterType ="vo.MemberVo" resultType="vo.Toto_Game_Vo">
 	<!--  현재 이용자가 배팅한 게임 목록  -->
				SELECT * FROM toto_gametable
				WHERE m_id=#{m_id} AND game_result='T'
				
    </select>




<insert id="insert_toto_schdule" parameterType="java.util.Map">

   INSERT INTO toto_schdule(winner_ratio,lose_ratio,p_idx,toto_place) VALUES                                           
                         <!-- list는 map으로 보낸 데이터의 키값이다.-->
     
                       <foreach collection="list" item="vo" separator=",">
           				(          				
           				 #{vo.winner_ratio},
           				 #{vo.lose_ratio},          	
           				 #{vo.p_idx},
           				 #{vo.toto_place}    			 
        				    )
        				</foreach>   
  
</insert>
	
	<delete id="delete_table">
	truncate table toto_schdule
	</delete>

											     			
	<update id="update_table" parameterType="vo.TotoValueVo">
		<!-- 미사용 -->
          			update toto_schdule set	    			 
           			home_team= #{home_team}, 
           	     	away_team= #{away_team},
           			winner_ratio=#{winner_ratio},
           		    lost_ratio= #{lose_ratio},
           			toto_place=#{toto_place}              			
           			where toto_idx=#{toto_idx}        		    				 		  
	  </update>


    <select id="select_game_list" resultType="vo.Toto_sch_Vo">
 	<!-- 게임 일정  -->
		SELECT t.*,p.p_date,p.p_score,p.p_rts,p.s_idx,p.t_home,p.t_away
		FROM toto_schdule t LEFT OUTER JOIN play p
		ON t.p_idx = p.p_idx
 
    </select>

	<update id="toto_game_result_update" parameterType="vo.Toto_Game_Vo">
			UPDATE toto_gametable SET			    
        	game_result=#{game_result} 
        	where p_idx=#{p_idx}		
	</update>

		<update id="toto_game_result_remove" parameterType="vo.Toto_Game_Vo">
			UPDATE toto_gametable SET			    
        	game_result=#{game_result} 
        	where p_idx=#{p_idx}		
	</update>

		
	<update id="toto_game_money" parameterType="vo.MemberVo">
			UPDATE member SET			    
        	m_money=#{m_money} 
        	where m_idx=#{m_idx}	
	</update>


</mapper>
